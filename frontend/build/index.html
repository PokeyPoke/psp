<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#3b82f6" />
  <title>Political Sentiment Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <style>
    .stage-gradient { background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%); }
    .candidate-card { transition: transform 0.2s ease; }
    .candidate-card:hover { transform: scale(1.05); }
    .rank-badge { background: linear-gradient(45deg, #ffd700, #ffed4a); }
  </style>
</head>
<body class="bg-gray-50">
  <div id="root"></div>
  
  <script>
    const { useState, useEffect } = React;
    
    function HomePage() {
      const [candidates, setCandidates] = useState([]);
      const [candidateMetrics, setCandidateMetrics] = useState({});
      const [loading, setLoading] = useState(true);
      const [selectedView, setSelectedView] = useState('grid');
      const [sortBy, setSortBy] = useState('votes');
      
      useEffect(() => {
        fetch('/api/candidates')
          .then(res => res.json())
          .then(data => {
            setCandidates(data);
            
            // Load metrics for each candidate
            const metricsPromises = data.map(async (candidate) => {
              try {
                const response = await fetch('/api/metrics/' + candidate.id + '/summary');
                const metrics = await response.json();
                return { candidateId: candidate.id, metrics };
              } catch (error) {
                return { candidateId: candidate.id, metrics: {} };
              }
            });
            
            Promise.all(metricsPromises).then(results => {
              const metricsMap = {};
              results.forEach(({ candidateId, metrics }) => {
                metricsMap[candidateId] = metrics;
              });
              setCandidateMetrics(metricsMap);
              setLoading(false);
            });
          })
          .catch(() => setLoading(false));
      }, []);
      
      const getSortedCandidates = () => {
        const candidatesWithMetrics = candidates.map(candidate => ({
          ...candidate,
          metrics: candidateMetrics[candidate.id] || {}
        }));

        return candidatesWithMetrics.sort((a, b) => {
          switch (sortBy) {
            case 'votes':
              return (b.metrics.vote_count || 0) - (a.metrics.vote_count || 0);
            case 'sentiment':
              return (b.metrics.reddit_sentiment || 0) - (a.metrics.reddit_sentiment || 0);
            case 'mentions':
              return ((b.metrics.reddit_mentions || 0) + (b.metrics.news_mentions || 0)) - 
                     ((a.metrics.reddit_mentions || 0) + (a.metrics.news_mentions || 0));
            case 'name':
              return a.name.localeCompare(b.name);
            default:
              return 0;
          }
        });
      };
      
      if (loading) {
        return React.createElement('div', { className: 'min-h-screen stage-gradient flex items-center justify-center' },
          React.createElement('div', { className: 'text-center text-white' },
            React.createElement('h1', { className: 'text-4xl font-bold mb-4' }, 'Political Sentiment Tracker'),
            React.createElement('div', { className: 'animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto' })
          )
        );
      }
      
      const sortedCandidates = getSortedCandidates();
      
      return React.createElement('div', { className: 'min-h-screen bg-gray-50' },
        // Header
        React.createElement('header', { className: 'stage-gradient text-white' },
          React.createElement('div', { className: 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12' },
            React.createElement('div', { className: 'text-center' },
              React.createElement('h1', { className: 'text-4xl md:text-6xl font-bold mb-4' }, 'Political Sentiment Tracker'),
              React.createElement('p', { className: 'text-xl md:text-2xl mb-8 text-blue-100' }, 'Track, vote, and analyze political sentiment in real-time'),
              
              // Quick Stats
              React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-6 max-w-4xl mx-auto' },
                React.createElement('div', { className: 'bg-white bg-opacity-20 rounded-lg p-4 backdrop-blur-sm' },
                  React.createElement('div', { className: 'text-3xl font-bold' }, candidates.length),
                  React.createElement('div', { className: 'text-blue-100' }, 'Candidates')
                ),
                React.createElement('div', { className: 'bg-white bg-opacity-20 rounded-lg p-4 backdrop-blur-sm' },
                  React.createElement('div', { className: 'text-3xl font-bold' }, 
                    Object.values(candidateMetrics).reduce((sum, metrics) => sum + (metrics.vote_count || 0), 0).toLocaleString()
                  ),
                  React.createElement('div', { className: 'text-blue-100' }, 'Total Votes')
                ),
                React.createElement('div', { className: 'bg-white bg-opacity-20 rounded-lg p-4 backdrop-blur-sm' },
                  React.createElement('div', { className: 'text-3xl font-bold' }, 'Live'),
                  React.createElement('div', { className: 'text-blue-100' }, 'Updates')
                ),
                React.createElement('div', { className: 'bg-white bg-opacity-20 rounded-lg p-4 backdrop-blur-sm' },
                  React.createElement('div', { className: 'text-3xl font-bold' }, '24/7'),
                  React.createElement('div', { className: 'text-blue-100' }, 'Tracking')
                )
              )
            )
          )
        ),
        
        // Main Content
        React.createElement('div', { className: 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8' },
          React.createElement('div', { className: 'lg:grid lg:grid-cols-4 lg:gap-8' },
            // Main Content Area
            React.createElement('div', { className: 'lg:col-span-3' },
              // Top 3 Candidates
              sortedCandidates.length > 0 && React.createElement('div', { className: 'mb-12' },
                React.createElement('h2', { className: 'text-3xl font-bold text-center mb-8 text-gray-900' }, 'ðŸ† Leading the Stage'),
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-8' },
                  sortedCandidates.slice(0, 3).map((candidate, index) => {
                    const gradientClass = index === 0 ? 'bg-gradient-to-br from-blue-500 to-blue-700' :
                                        index === 1 ? 'bg-gradient-to-br from-red-500 to-red-700' :
                                        'bg-gradient-to-br from-purple-500 to-purple-700';
                    
                    const badgeClass = index === 0 ? 'rank-badge' : 'bg-gray-400';
                    
                    const textColorClass = index === 0 ? 'text-blue-200' : 
                                          index === 1 ? 'text-red-200' : 'text-purple-200';
                    
                    return React.createElement('div', {
                      key: candidate.id,
                      className: 'relative rounded-2xl p-8 text-white transform hover:scale-105 transition-transform duration-200 ' + gradientClass
                    },
                      React.createElement('div', {
                        className: 'absolute -top-4 -right-4 w-16 h-16 rounded-full flex items-center justify-center text-black font-bold text-xl ' + badgeClass
                      }, '#' + (index + 1)),
                      React.createElement('div', { className: 'text-center' },
                        React.createElement('div', { className: 'w-32 h-32 rounded-full mx-auto mb-6 border-4 border-white bg-gray-300 flex items-center justify-center text-2xl font-bold text-gray-600' },
                          candidate.name.split(' ').map(n => n[0]).join('').toUpperCase()
                        ),
                        React.createElement('h3', { className: 'text-3xl font-bold mb-2' }, candidate.name),
                        React.createElement('p', { className: 'mb-4 ' + textColorClass },
                          candidate.party + ' â€¢ #' + (index + 1) + ' Overall'
                        ),
                        React.createElement('div', { className: 'grid grid-cols-2 gap-4 mb-6' },
                          React.createElement('div', { className: 'bg-white bg-opacity-20 rounded-lg p-3' },
                            React.createElement('div', { className: 'text-2xl font-bold' },
                              (candidateMetrics[candidate.id] && candidateMetrics[candidate.id].vote_count || 0).toLocaleString()
                            ),
                            React.createElement('div', { className: 'text-sm ' + textColorClass }, 'Votes')
                          ),
                          React.createElement('div', { className: 'bg-white bg-opacity-20 rounded-lg p-3' },
                            React.createElement('div', { className: 'text-2xl font-bold' },
                              (candidateMetrics[candidate.id] && candidateMetrics[candidate.id].reddit_sentiment > 0 ? '+' : '') + 
                              (candidateMetrics[candidate.id] && candidateMetrics[candidate.id].reddit_sentiment || 0).toFixed(2)
                            ),
                            React.createElement('div', { className: 'text-sm ' + textColorClass }, 'Sentiment')
                          )
                        ),
                        React.createElement('button', { className: 'w-full bg-white text-gray-900 font-bold py-3 rounded-lg hover:bg-gray-100 transition-colors' },
                          'View Full Profile'
                        )
                      )
                    );
                  })
                )
              ),
              
              // Remaining Candidates
              sortedCandidates.length > 3 && React.createElement('div', {},
                React.createElement('h2', { className: 'text-3xl font-bold mb-8 text-gray-900' }, 'All Candidates on Stage'),
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4' },
                  sortedCandidates.slice(3).map((candidate, index) =>
                    React.createElement('div', {
                      key: candidate.id,
                      className: 'bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow p-4'
                    },
                      React.createElement('div', { className: 'text-center' },
                        React.createElement('div', { className: 'relative' },
                          React.createElement('div', { className: 'w-16 h-16 rounded-full mx-auto mb-3 bg-gray-300 flex items-center justify-center text-lg font-bold text-gray-600' },
                            candidate.name.split(' ').map(n => n[0]).join('').toUpperCase()
                          ),
                          React.createElement('span', { className: 'absolute -top-2 -right-2 bg-blue-500 text-white text-xs font-bold px-2 py-1 rounded-full' },
                            '#' + (index + 4)
                          )
                        ),
                        React.createElement('h3', { className: 'font-bold text-lg mb-1' }, candidate.name),
                        React.createElement('p', { className: 'text-blue-600 text-sm mb-3' }, candidate.party),
                        React.createElement('div', { className: 'grid grid-cols-2 gap-2 mb-3' },
                          React.createElement('div', { className: 'bg-blue-50 rounded p-2' },
                            React.createElement('div', { className: 'font-bold text-sm' },
                              (candidateMetrics[candidate.id] && candidateMetrics[candidate.id].vote_count || 0).toLocaleString()
                            ),
                            React.createElement('div', { className: 'text-xs text-gray-600' }, 'Votes')
                          ),
                          React.createElement('div', { className: 'bg-green-50 rounded p-2' },
                            React.createElement('div', { className: 'font-bold text-sm text-green-600' },
                              (candidateMetrics[candidate.id] && candidateMetrics[candidate.id].reddit_sentiment > 0 ? '+' : '') +
                              (candidateMetrics[candidate.id] && candidateMetrics[candidate.id].reddit_sentiment || 0).toFixed(2)
                            ),
                            React.createElement('div', { className: 'text-xs text-gray-600' }, 'Sentiment')
                          )
                        ),
                        React.createElement('div', { className: 'flex space-x-2' },
                          React.createElement('button', { className: 'flex-1 bg-blue-600 text-white py-2 px-3 rounded text-sm hover:bg-blue-700' }, 'Vote'),
                          React.createElement('button', { className: 'flex-1 border border-gray-300 py-2 px-3 rounded text-sm hover:bg-gray-50' }, 'Details')
                        )
                      )
                    )
                  )
                )
              )
            ),
            
            // Sidebar
            React.createElement('div', { className: 'lg:col-span-1 mt-8 lg:mt-0' },
              React.createElement('div', { className: 'space-y-6' },
                // Advanced Analytics
                React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6' },
                  React.createElement('h3', { className: 'text-xl font-bold mb-4 text-gray-900' }, 'ðŸ“Š Advanced Analytics'),
                  React.createElement('div', { className: 'mb-6' },
                    React.createElement('h4', { className: 'font-semibold text-gray-800 mb-3' }, 'ðŸ† Top Performers'),
                    React.createElement('div', { className: 'space-y-2' },
                      React.createElement('div', { className: 'flex justify-between text-sm' },
                        React.createElement('span', {}, 'Most Voted'),
                        React.createElement('span', { className: 'font-medium' }, sortedCandidates[0] && sortedCandidates[0].name || 'N/A')
                      ),
                      React.createElement('div', { className: 'flex justify-between text-sm' },
                        React.createElement('span', {}, 'Best Sentiment'),
                        React.createElement('span', { className: 'font-medium' }, 
                          sortedCandidates.sort((a, b) => (candidateMetrics[b.id] && candidateMetrics[b.id].reddit_sentiment || 0) - (candidateMetrics[a.id] && candidateMetrics[a.id].reddit_sentiment || 0))[0] && 
                          sortedCandidates.sort((a, b) => (candidateMetrics[b.id] && candidateMetrics[b.id].reddit_sentiment || 0) - (candidateMetrics[a.id] && candidateMetrics[a.id].reddit_sentiment || 0))[0].name || 'N/A'
                        )
                      )
                    )
                  )
                ),
                
                // Historical Performance
                React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6' },
                  React.createElement('h3', { className: 'text-xl font-bold mb-4 text-gray-900' }, 'ðŸ“ˆ Historical Performance'),
                  React.createElement('div', { className: 'bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-4' },
                    React.createElement('h4', { className: 'font-semibold text-green-800 mb-2' }, 'Recent Trends'),
                    React.createElement('div', { className: 'space-y-2 text-sm' },
                      React.createElement('div', {}, 'ðŸ“… 7 days ago: Leadership shuffle'),
                      React.createElement('div', {}, 'ðŸ“… Today: Record activity')
                    )
                  )
                )
              )
            )
          )
        )
      );
    }
    
    ReactDOM.render(React.createElement(HomePage), document.getElementById('root'));
  </script>
</body>
</html>